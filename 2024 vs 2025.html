<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024 vs 2025 生產數據分析報告</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- 引入 DataLabels 插件 -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 20px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">生產數據比較分析報告</h1>
            <p class="text-gray-600 mt-2">比較區間：2024 全年 vs 2025 全年 | 資料來源：總表(2024/2025) - 2F</p>
        </header>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card border-l-4 border-blue-500">
                <h3 class="text-sm text-gray-500 font-medium">2024 總產量</h3>
                <p class="text-3xl font-bold text-gray-800 mt-1">36,188</p>
                <span class="text-xs text-gray-400">件/年</span>
            </div>
            <div class="card border-l-4 border-emerald-500">
                <h3 class="text-sm text-gray-500 font-medium">2025 總產量</h3>
                <p class="text-3xl font-bold text-gray-800 mt-1">24,536</p>
                <span class="text-xs text-red-500 font-bold">▼ 32.2% (較去年)</span>
            </div>
            <div class="card border-l-4 border-purple-500">
                <h3 class="text-sm text-gray-500 font-medium">最大變化類別 (AD)</h3>
                <p class="text-3xl font-bold text-gray-800 mt-1">-11,408</p>
                <span class="text-xs text-red-500">件數減少 (跌幅 71%)</span>
            </div>
        </div>

        <!-- Charts Row 1: Category Comparison -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="card">
                <h2 class="text-xl font-bold text-gray-800 mb-4">各產品類別年度產量對比</h2>
                <canvas id="categoryChart"></canvas>
                <p class="text-sm text-gray-500 mt-4 text-center">AD 與起子產量大幅縮減，但小扭力與定扭扳手逆勢成長。</p>
            </div>
            <div class="card">
                <h2 class="text-xl font-bold text-gray-800 mb-4">2025 年產品佔比分佈</h2>
                <div class="h-64 flex justify-center">
                    <canvas id="pieChart"></canvas>
                </div>
                <p class="text-sm text-gray-500 mt-4 text-center">小扭力成為 2025 年最大宗產品 (36.5%)，其次為指針式 (25.4%)。</p>
            </div>
        </div>

        <!-- Charts Row 2: Monthly Trend -->
        <div class="card mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">每月總產量趨勢 (2024 vs 2025)</h2>
            </div>
            <div class="h-80">
                <canvas id="trendChart"></canvas>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6 text-sm text-gray-600 bg-gray-50 p-4 rounded-lg">
                <div>
                    <strong class="text-blue-600">2024 特徵：</strong> 
                    峰值出現在 2月 (4,491件) 與 6月 (3,843件)。年中波動較大，8月亦有小高峰。
                </div>
                <div>
                    <strong class="text-emerald-600">2025 特徵：</strong> 
                    開局強勁，1月達峰值 (3,493件)，隨後 2-5月 呈現下降趨勢。下半年 9月 與 11月 有回升跡象。
                </div>
            </div>
        </div>

        <!-- Detailed Analysis Text -->
        <div class="card bg-slate-50 border border-slate-200">
            <h2 class="text-xl font-bold text-gray-800 mb-4">綜合分析報告</h2>
            <div class="prose max-w-none text-gray-700 space-y-4">
                <p>
                    <strong>1. 產量結構性調整：</strong>
                    數據顯示公司生產重心正在轉移。2024 年高度依賴的 <strong>AD 產品</strong>（佔當年總量 44%），在 2025 年佔比降至 19%。取而代之的是 <strong>小扭力</strong> 與 <strong>指針式扭力扳手</strong>，兩者合計佔 2025 年總產量的 62%。這可能反映了市場需求的變化或是公司主動調整產品線策略。
                </p>
                <p>
                    <strong>2. 穩定成長的產品線：</strong>
                    儘管總量下滑，<strong>定扭扳手</strong> 展現了最強勁的成長動能（+44%），且在 2025 年 5月、11月 都有穩定的高產出。<strong>小扭力</strong> 產品雖然 3月、6月 產量極低，但憑藉 1月、2月 的大量產出，整年仍維持正成長。
                </p>
                <p>
                    <strong>3. 潛在風險提示：</strong>
                    <strong>起子</strong> 類產品產量萎縮嚴重（-84%），且多個月份（2025年 3, 5, 6, 9, 11, 12月）產量極低或掛零。建議評估該產品線是否進入衰退期，或是否為庫存調整所致。
                </p>
            </div>
        </div>
    </div>

    <script>
        // Register the DataLabels plugin globally
        Chart.register(ChartDataLabels);

        // Data Extraction from PDF contents
        const categories = ["小扭力", "大扭力", "AD", "起子", "指針式", "定扭扳手", "機械式"];
        
        // 2024 Data (Source: 總表(2024))
        const data2024 = {
            total: [8195, 1610, 15981, 2307, 5496, 1491, 1108],
            monthlyTotal: [
                2980, 4491, 2214, 2897, 4027, 3843, 1478, 3736, 3223, 1930, 2120, 3304
            ]
        };

        // 2025 Data (Source: 總表(2025) - corrected logic for May/Jun)
        const data2025 = {
            total: [8968, 1242, 4573, 373, 6221, 2152, 1007],
            monthlyTotal: [
                3493, 3932, 1150, 1012, 1978, 260, 1888, 2109, 2644, 1797, 2525, 1168
            ]
        };

        // Chart 1: Category Comparison (Bar)
        const ctxCategory = document.getElementById('categoryChart').getContext('2d');
        new Chart(ctxCategory, {
            type: 'bar',
            data: {
                labels: categories,
                datasets: [
                    {
                        label: '2024 年產量',
                        data: data2024.total,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1,
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            offset: -2 // slight adjustment
                        }
                    },
                    {
                        label: '2025 年產量',
                        data: data2025.total,
                        backgroundColor: 'rgba(16, 185, 129, 0.6)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 1,
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            offset: -2
                        }
                    }
                ]
            },
            options: {
                responsive: true,
                layout: {
                    padding: {
                        top: 25 // Avoid labels getting cut off
                    }
                },
                plugins: {
                    legend: { position: 'top' },
                    datalabels: {
                        color: '#444',
                        font: {
                            weight: 'bold',
                            size: 10
                        },
                        formatter: function(value) {
                            return value.toLocaleString(); // Add commas
                        }
                    },
                    tooltip: {
                        callbacks: {
                            afterLabel: function(context) {
                                let idx = context.dataIndex;
                                let v24 = data2024.total[idx];
                                let v25 = data2025.total[idx];
                                if(context.datasetIndex === 1) { 
                                    let diff = ((v25 - v24) / v24 * 100).toFixed(1);
                                    return `YoY 變化: ${diff}%`;
                                }
                            }
                        }
                    }
                }
            }
        });

        // Chart 2: 2025 Distribution (Pie)
        const ctxPie = document.getElementById('pieChart').getContext('2d');
        new Chart(ctxPie, {
            type: 'doughnut',
            data: {
                labels: categories,
                datasets: [{
                    data: data2025.total,
                    backgroundColor: [
                        '#3B82F6', '#EF4444', '#F59E0B', '#6366F1', '#10B981', '#8B5CF6', '#EC4899'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right' },
                    datalabels: {
                        color: '#fff',
                        font: {
                            weight: 'bold',
                            size: 11
                        },
                        formatter: function(value, context) {
                            // Only show label if value is significant enough to fit (e.g. > 3%)
                            let total = context.chart._metasets[context.datasetIndex].total;
                            let percentage = (value / total * 100).toFixed(1) + "%";
                            
                            // Return Value on top, Percentage below
                            if (value > 400) { // arbitrary threshold to hide labels on tiny slices
                                return value.toLocaleString();
                            } else {
                                return null;
                            }
                        }
                    }
                }
            }
        });

        // Chart 3: Monthly Trend (Line) - Disable DataLabels for cleanliness
        const months = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
        const ctxTrend = document.getElementById('trendChart').getContext('2d');
        new Chart(ctxTrend, {
            type: 'line',
            data: {
                labels: months,
                datasets: [
                    {
                        label: '2024 總產量',
                        data: data2024.monthlyTotal,
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: '2025 總產量',
                        data: data2025.monthlyTotal,
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    // Hide datalabels for the line chart to avoid clutter
                    datalabels: {
                        display: false
                    }
                },
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: '產量 (件)' }
                    }
                }
            }
        });
    </script>
</body>
</html>
